import { prisma } from "@/lib/prisma";
import StatisticCard from "./statistic-card";
import { getCurrentUser } from "@/lib/auth-utils";

export default async function StatisticsWrapper() {
  const currentUser = await getCurrentUser();
  const [allCardsCount, masteredCount, inProgressCount, notStartedCount] =
    currentUser
      ? await Promise.all([
          prisma.flashcard.count({
            where: {
              userId: currentUser.id,
            },
          }),
          prisma.flashcard.count({
            where: {
              isMastered: true,
              userId: currentUser.id,
            },
          }),
          prisma.flashcard.count({
            where: {
              progress: {
                not: 0,
              },
              userId: currentUser.id,
            },
          }),
          prisma.flashcard.count({
            where: {
              progress: {
                equals: 0,
              },
              userId: currentUser.id,
            },
          }),
        ])
      : [0, 0, 0, 0];

  return (
    <div className="w-full bg-white rounded-2xl border-2 border-foreground shadow-right-bottom p-6">
      <h2 className="font-semibold text-2xl mb-4">Study Statistics</h2>
      <div className="grid grid-cols-1 gap-5 max-lg:grid-cols-2 max-sm:grid-cols-1">
        {/* TOTAL CARDS */}
        <StatisticCard
          text="Total Cards"
          count={allCardsCount.toString()}
          background="bg-chart-1"
        >
          <svg
            fill="none"
            height="24"
            viewBox="0 0 24 24"
            width="24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="m24 12.0352c0 .5625-.375 1.125-.9375 1.3593l-3.7031 1.5938 3.7031 1.6406c.5625.2344.8906.7969.8906 1.4063 0 .5625-.3281 1.125-.8906 1.3593l-10.2187 4.4532c-.2813.0937-.5626.1406-.8907.1406-.2343 0-.6093-.0469-.8437-.1406l-10.218775-4.4532c-.5625-.2343-.890625-.7968-.890625-1.3593 0-.6094.328125-1.1719.890625-1.4063l3.703125-1.6406-3.703125-1.5938c-.5625-.2343-.890625-.7968-.890625-1.3593 0-.6094.328125-1.1719.890625-1.4063l3.703125-1.64062-3.703125-1.59375c-.5625-.23437-.890625-.79687-.890625-1.40625 0-.5625.328125-1.125.890625-1.35937l10.218775-4.453129c.5625-.2343748 1.1718-.2343748 1.7344 0l10.2187 4.453129c.5625.23437.9375.79687.9375 1.35937 0 .60938-.375 1.17188-.9375 1.40625l-3.7031 1.59375 3.7031 1.64062c.5625.2344.9375.7969.9375 1.4063zm-12-9.75004-8.67188 3.70312 8.67188 3.79688 8.625-3.75zm8.625 15.75004-4.125-1.7813-3.6562 1.5938c-.2813.0937-.5626.1406-.8438.1406s-.6562-.0469-.8906-.1406l-3.65628-1.5938-4.125 1.7344 8.67188 3.7969zm-8.625-2.25 8.625-3.75-4.125-1.7813-3.6562 1.5938c-.2813.0937-.5626.1406-.8438.1406s-.6562-.0469-.8906-.1406l-3.65628-1.5938-4.125 1.7344z"
              fill="currentColor"
            />
          </svg>
        </StatisticCard>
        {/* MASTERED CARDS */}
        <StatisticCard
          text="Mastered"
          count={masteredCount.toString()}
          background="bg-chart-2"
        >
          <svg
            fill="none"
            height="24"
            viewBox="0 0 26 24"
            width="26"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="m23.9531 10.7344c.9844.8437 1.5469 2.0625 1.5 3.3281 0 1.5469-.75 2.9531-2.0156 3.7969-.0469 2.2031-1.8281 4.0312-4.0313 4.125-.75 1.2656-2.1093 2.0156-3.6093 2.0156-1.2188 0-2.2969-.5156-3.0938-1.3125-.75.7969-1.8281 1.3125-3.04685 1.3125-1.5 0-2.85937-.75-3.60937-2.0156-2.20313-.0938-3.98438-1.9219-4.03126-4.125-1.26562-.8438-2.01562-2.25-2.01562-3.7969 0-1.2656.515625-2.4844 1.5-3.3281-.09375-.375-.14062-.75002-.14062-1.07815 0-1.54687.75-2.95313 2.01562-3.79687.04688-1.875 1.40625-3.42188 3.1875-3.75.65625-1.26563 1.96875-2.10938 3.42188-2.10938.89062 0 2.10942.515625 2.76562 1.17188.6562-.70313 1.6406-1.17188 2.7188-1.17188 1.4531 0 2.7656.84375 3.4218 2.10938 1.7813.32812 3.1406 1.875 3.1875 3.75 1.2657.84374 2.0157 2.25 2.0157 3.79687 0 .32813-.0469.70315-.1407 1.07815zm-12.375 9.0937v-15.93748c0-.89062-.7031-1.59374-1.59372-1.59374-.70313 0-1.35938.46874-1.54688 1.17187l-.23438.89063-1.03124-.04688c-.79688 0-1.5.70312-1.5 1.59375 0 .1875 0 .23437.23437 1.26563l-.89063.375c-.60937.23437-1.96874 1.40624-1.17187 3.09372l.46875.9375-.89062.5157c-1.6875.9843-1.5 3.375.23437 4.0781l.84375.3281s-.1875 1.1719-.1875 1.3125c0 1.1719 1.125 2.0625 2.25 1.875l.9375-.1406c.28125.8437.60938 2.2031 2.15625 2.2031 1.07815 0 1.92185-.8438 1.92185-1.9219zm10.2188-3.6562c1.7343-.7031 1.9219-3.0938.2343-4.0781l-.8906-.5157.4688-.9375c.7968-1.68748-.5625-2.85935-1.1719-3.09372l-.8906-.375c.2343-1.03126.2343-1.07813.2343-1.26563 0-.89063-.7031-1.59375-1.5-1.59375l-1.0781.04688-.1875-.89063c-.1875-.70313-.8437-1.21875-1.5468-1.21875-.8907 0-1.5938.75-1.5938 1.59375v15.98435c0 1.0781.8438 1.9219 1.9219 1.9219 1.5469 0 1.875-1.3594 2.1562-2.2031l.9375.1406c1.125.1875 2.25-.7031 2.25-1.875 0-.1406-.1875-1.3125-.1875-1.3125z"
              fill="currentColor"
            />
          </svg>
        </StatisticCard>
        {/* IN PROGRESS */}
        <StatisticCard
          text="In Progress"
          count={inProgressCount.toString()}
          background="bg-chart-3"
        >
          <svg
            fill="none"
            height="24"
            viewBox="0 0 30 24"
            width="30"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="m26.2969 0c2.0156 0 3.7031 1.64062 3.7031 3.60938v14.71872c0 1.875-1.5469 3.4688-3.4688 3.5625-1.7343.0938-6.0468.4688-8.8124 1.8282-.375.1874-.7969.2812-1.2188.2812h-3.0469c-.4219 0-.8437-.0938-1.2187-.2812-2.76565-1.3594-7.07815-1.7344-8.81252-1.8282-1.92188-.0937-3.42188-1.6875-3.42188-3.5625v-14.71872c0-1.96876 1.64062-3.60938 3.65625-3.60938.5625 0 7.26565.328125 11.34375 2.67188 4.0312-2.343755 10.7344-2.67188 11.2969-2.67188zm-12.4219 20.5781v-10.0781l-.0469-4.96875c0-.5625-.3281-1.125-.8906-1.35937-3.375-1.54688-8.39062-1.875-9.28125-1.92188-.79687 0-1.40625.60938-1.40625 1.35938v14.71872c0 .7031.5625 1.2657 1.3125 1.3125 2.0625.1406 6.28125.4688 9.2813 1.6406.5156.1876 1.0312-.1874 1.0312-.7031zm13.875-2.25v-14.71872c0-.75-.6562-1.35938-1.4531-1.35938-.8907.04688-5.9063.375-9.2813 1.92188-.5625.23437-.8906.79687-.8906 1.35937v15.04685c0 .5157.4688.8907.9844.7031 3-1.1718 7.2187-1.5 9.2812-1.6406.75-.0468 1.3594-.6094 1.3594-1.3125z"
              fill="currentColor"
            />
          </svg>
        </StatisticCard>
        {/* NOT STARTED */}
        <StatisticCard
          text="Not Started"
          count={notStartedCount.toString()}
          background="bg-chart-4"
        >
          <svg
            fill="none"
            height="18"
            viewBox="0 0 27 18"
            width="27"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="m26.5781 8.0625c.2813.375.4219.84375.4219 1.3125v6.375c0 1.2656-1.0312 2.25-2.25 2.25h-22.5c-1.265625 0-2.25-.9844-2.25-2.25v-6.375c0-.42188.140625-.98438.375-1.3125l4.92188-7.078125c.375-.515625 1.21874-.984375 1.875-.984375h12.60932c.6563 0 1.5.46875 1.875.984375zm-19.40622-5.8125-3.65626 5.25h5.71876l1.50002 3h5.4844l1.5-3h5.7187l-3.6563-5.25zm17.57812 13.5v-6h-5.625l-1.5 3h-8.25l-1.5-3h-5.625v6z"
              fill="currentColor"
            />
          </svg>
        </StatisticCard>
      </div>
    </div>
  );
}
